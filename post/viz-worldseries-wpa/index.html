<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.31.1" />
  <meta name="author" content="Silas Bergen">
  <meta name="description" content="Assistant professor of statistics and data science">

  
  <link rel="alternate" hreflang="en-us" href="http://driftlessdata.space/post/viz-worldseries-wpa/">

  
  


  

  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-111127083-1', 'auto');
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  
  <link rel="alternate" href="http://driftlessdata.space/index.xml" type="application/rss+xml" title="Driftless Data">
  <link rel="feed" href="http://driftlessdata.space/index.xml" type="application/rss+xml" title="Driftless Data">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="http://driftlessdata.space/post/viz-worldseries-wpa/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Driftless Data">
  <meta property="og:url" content="http://driftlessdata.space/post/viz-worldseries-wpa/">
  <meta property="og:title" content="Quantifying thrill | Driftless Data">
  <meta property="og:description" content="">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2017-10-31T00:00:00-05:00">
  
  <meta property="article:modified_time" content="2017-10-31T00:00:00-05:00">
  

  

  <title>Quantifying thrill | Driftless Data</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Driftless Data</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-left">
        

        

        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#talks">
            
            <span>Presentations</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact &amp; Office Hours</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <div class="article-inner">
      <h1 itemprop="name">Quantifying thrill</h1>

      

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2017-10-31 00:00:00 -0500 CDT" itemprop="datePublished">
      Oct 31, 2017
    </time>
  </span>

  

  
  

  

  
  

  

</div>


      <div class="article-style" itemprop="articleBody">
        <p>Monday morning, October 30, found me groggy and sandy-eyed.  The culprit was the 5-hour and 17-minute, 10-inning thriller between the LA Dodgers and Houston Astros in Game 5 of the 2017 the night before.  Thanks to living in the Central Time Zone, I went to bed around 1am. The Astros ended up defeating the Dodgers 13-12, but the game was insane, featuring three comebacks from deficits of 3 runs or more.  By the end, I was emotionally exhausted, and I didn&rsquo;t even have a stake in either team!  Lots was written about the game over at <a href="http://www.fangraphs.com/">Fangraphs</a>, one of my favorite baseball analytics websites.</p>

<p>One <a href="https://www.fangraphs.com/blogs/game-five-was-as-weird-as-it-felt/">post in particular</a> by Craig Edwards caught my attention from a data visualization perspective.  It compared the game to another epic game: <a href="https://www.baseball-reference.com/boxes/SLN/SLN201110270.shtml">Game 6 of the 2011 World Series</a>, where the St. Louis Cardinals staved off elimination by defeating the Texas Rangers 10-9 in 11 innings.  The crux of the article was a table that listed the top-20 &ldquo;most exciting events&rdquo; of each World Series side-by-side.  Here is a screenshot of said table:</p>

<p><center>
<figure>
<img src="/img/wpa-table.JPG" width="400" />
</figure>
</center></p>

<p>An &ldquo;exciting event&rdquo; is one that yields a large swing in the win expectancy of the game, as measured by Win Probability Added, or WPA.  Read Fangraph&rsquo;s <a href="https://www.fangraphs.com/library/misc/wpa/">excellent glossary entry on WPA</a> for more detail, but essentially, the bigger the WPA of an event, the more exciting it is.</p>

<p>The table is great, but it&rsquo;s hard to see which of the two games has the <em>most</em> exciting Top-20 events.  I wanted to visualize!  But I needed the data.  Fangraphs has play logs for every single Major League game, which lists (among other metrics) the events of the game; the win expectancy following the event; and the WPA of the event.  I needed data from the <a href="https://www.fangraphs.com/plays.aspx?date=2011-10-27&amp;team=Cardinals&amp;dh=0&amp;season=2011">Game 6, 2011</a> and the <a href="https://www.fangraphs.com/plays.aspx?date=2017-10-29&amp;team=Astros&amp;dh=0&amp;season=2017">Game 5, 2017</a> play logs.  But I needed them both in the same data source!</p>

<p><code>R</code> has a great package <code>rvest</code> that makes web-scraping (especially scraping html tables) quite easy.  Here&rsquo;s the code I wrote to scrape the <a href="https://www.fangraphs.com/plays.aspx?date=2011-10-27&amp;team=Cardinals&amp;dh=0&amp;season=2011">Game 6, 2011</a> data; do some cleaning; and write the cleaned data into a .csv file.  I wrote very similar code to get the <a href="https://www.fangraphs.com/plays.aspx?date=2017-10-29&amp;team=Astros&amp;dh=0&amp;season=2017">Game 5, 2017</a> data:</p>

<pre><code>library(rvest)
library(dplyr)
#Read in the data, find the right table:
url &lt;- 'https://www.fangraphs.com/plays.aspx?date=2011-10-27&amp;team=Cardinals&amp;dh=0&amp;season=2011'
raw &lt;- read_html(url)%&gt;%
       html_table(fill=TRUE)
mytable &lt;- raw[[9]][,1:12]

#Use dplyr to clean it up. By code row:
  #Create absolute value of WPA
  #Create new column to indicate the game
  #Remove the &quot;%&quot; from the win expectancy, create Event number
  #Arrange in descending order by WPA
  #Create rank column
cleantable &lt;- mytable %&gt;%
  mutate(WPA_abs = abs(WPA)) %&gt;%                                            
  mutate(Game = rep('Game 6, 2011',nrow(mytable))) %&gt;%                    
  mutate(WE = as.numeric(gsub('%','',WE)), Event = 1:nrow(mytable)) %&gt;%      
  arrange(-WPA_abs) %&gt;%                                                     
  mutate(WPA_Rank = 1:nrow(mytable))                                          

#Write cleaned data to csv file
write.csv(cleantable,file='WPA_Game6_2011_all.csv',row.names=FALSE)
</code></pre>

<p>Then on to visualizing!  Using Tableau, I created a win-expectancy graph for each of the games.  The red dots indicate &ldquo;exciting events&rdquo;; events with WPA of 15% or more:</p>

<p><center>
<iframe src="https://public.tableau.com/views/WPA_WS_blog/tracker-dash?:embed=y?:showVizHome=no"
 width="755" height="392"></iframe>
</center></p>

<p>Clearly, both games were crazy, with wild swings in win expectancy!  If you count up the red dots, Game 6 in 2011 had 8 &ldquo;exciting events&rdquo; while Game 5 in 2017 had 10 &ldquo;exciting events.&rdquo;  15% is quite an arbitrary threshold for &ldquo;exciting&rdquo; however; different thresholds would likely change the comparison.  Comparing total WPA flips the story: the total WPA of 7.2 in Game 6, 2011 was larger than the total WPA of 6.2 in Game 5, 2017.</p>

<p>My primary interest, however, was to compare the top-20 most exciting events of both games in a clearer visual manner, respecting principles of human perception:</p>

<iframe src="https://public.tableau.com/views/WPA_WS_blog/Top-20?:embed=y?:showVizHome=no"
 width="655" height="495"></iframe>

<p>From this graph, we can see the four points on the right that lie below the reference line.  These indicate that the top four most exciting events in Game 6, 2011 were <em>more exciting</em> than the top four most exciting events from Game 5, 2017.  On the other hand, the top 5-10 most exciting events in Game 5, 2017 lie above the reference line, indicating they were more exciting than the events with WPA ranked 5-10 in Game 6, 2011.  The rest of the events ranked 11-20 in WPA go back to lying below the line.</p>

<p>So, it does appear that Game 6, 2011 was truly a more thrilling game than Game 5, 2017!   The total WPA of Game 6, 2011 was greater than the total WPA in Game 5, 2017, and of the top-20 &ldquo;most exciting&rdquo; events, they tended to be <em>more exciting</em> in 2011. Oh well, Game 5, 2017 was still worth losing a few hours of sleep!  I think&hellip;.</p>

      </div>

      


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/data-visualization">data visualization</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/r">R</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/baseball">baseball</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/web-scraping">web-scraping</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/tableau">Tableau</a>
  
</div>



    </div>
  </div>

</article>



<div class="article-container article-widget">
  <div class="hr-light"></div>
  <h3>Related</h3>
  <ul>
    
    <li><a href="/post/viz-oscars/">#OscarsSoWhite</a></li>
    
    <li><a href="/post/viz-waps-disparity/">Racial disparity in Winona Area Public School District</a></li>
    
    <li><a href="/project/uscots2017-workshop/">Web scraping and data visualization with Python and Tableau</a></li>
    
  </ul>
</div>




<div class="article-container">
  

</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2017 Silas Bergen &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

